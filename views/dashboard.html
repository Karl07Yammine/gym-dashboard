<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Dashboard – Scan QR</title>
  <link rel="stylesheet" href="/css/styles.css"/>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <meta name="theme-color" content="#0b0f14">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    /* ===== Design Tokens ===== */
    :root {
      --bg: #070b11;
      --bg-accent: #0b1220;
      --card: #0f1624;
      --card-elev: #131c2d;
      --border: #213049;
      --border-soft: #2a3a57;
      --text: #e6eefc;
      --muted: #a7b3c7;
      --brand: #5aa8ff;
      --brand-2: #8b5cf6;
      --good: #14b86a;
      --bad: #ef4444;
      --shadow: 0 10px 25px rgba(0,0,0,.4);
      --radius: 16px;
    }

    /* ===== Base ===== */
    html, body { height: 100%; }
    body {
      margin: 0; color: var(--text); background:
        radial-gradient(1200px 700px at 80% -10%, rgba(90,168,255,.08), transparent),
        radial-gradient(900px 600px at -10% 20%, rgba(139,92,246,.08), transparent),
        var(--bg);
      font: 14px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }

    /* ===== Topbar (more breathing room) ===== */
    .topbar {
      position: sticky; top: 0; z-index: 50;
      backdrop-filter: saturate(140%) blur(10px);
      background: linear-gradient(180deg, rgba(10,14,22,.75), rgba(10,14,22,.35));
      border-bottom: 1px solid var(--border-soft);
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
    }
    .topbar-inner{
      max-width: 1200px;
      margin: 0 auto;
      padding: clamp(14px, 2.2vw, 22px) clamp(16px, 3vw, 28px);
      display: flex; align-items: center; gap: 14px;
      justify-content: space-between; flex-wrap: wrap;
    }
    .brand {
      font-weight: 800; letter-spacing:.3px;
      font-size: clamp(18px, 2.6vw, 22px);
      line-height: 1;
    }
    nav { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

    .btn, .btn-outline {
      --pad-x: 14px; --pad-y: 10px;
      display: inline-flex; align-items: center; gap: 8px;
      padding: var(--pad-y) var(--pad-x); border-radius: 999px; border: 1px solid transparent;
      cursor: pointer; text-decoration: none; color: var(--text);
      transition: transform .05s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
      font-weight: 600; letter-spacing:.2px; line-height: 1;
    }
    .btn { background: linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: 0 6px 18px rgba(90,168,255,.25); }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }

    .btn-outline { background: transparent; border-color: var(--border); }
    .btn-outline:hover { border-color: rgba(138,168,255,.6); background: rgba(138,168,255,.06); }

    /* Make content breathe a bit more below the top bar */
    .container { max-width: 1024px; margin: clamp(16px, 3vw, 32px) auto; padding: 0 clamp(12px, 3vw, 24px); }

    .grid { display: grid; grid-template-columns: 1fr; gap: clamp(14px, 2.4vw, 22px); }
    @media (min-width: 980px) {
      .grid { grid-template-columns: 560px 1fr; align-items: start; }
    }

    .card {
      background: linear-gradient(180deg, var(--card), var(--card-elev));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: clamp(16px, 3vw, 24px);
    }

    h1, h2 { margin: 0 0 12px; font-weight: 800; letter-spacing: .2px; }
    h1 { font-size: clamp(20px, 3vw, 26px); }
    h2 { font-size: clamp(18px, 2.4vw, 22px); }
    .subtle { color: var(--muted); }

    .stack { display: grid; gap: 12px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .mt { margin-top: 14px; }
    .small { font-size: 12.5px; color: var(--muted); }

    /* ===== QR Region with softer frame ===== */
    #qrRegion {
      width: 100%; max-width: 560px; margin: 6px auto 0; aspect-ratio: 4 / 3;
      position: relative; border-radius: calc(var(--radius) - 4px);
      overflow: hidden; background: #0a0f18; border: 1px dashed var(--border);
    }
    .scan-frame {
      position: absolute; inset: clamp(10px, 1.8vw, 14px); border-radius: 12px; pointer-events: none;
      border: 2px solid rgba(138,168,255,.28);
      box-shadow: inset 0 0 0 1px rgba(138,168,255,.12);
    }
    .scan-line { position: absolute; left: 10%; right: 10%; height: 2px; top: 14%;
      background: linear-gradient(90deg, transparent, rgba(138,168,255,.8), transparent);
      filter: drop-shadow(0 0 6px rgba(138,168,255,.45));
      animation: sweep 2.6s linear infinite;
    }
    @keyframes sweep { 0% { top: 12%; } 50% { top: 80%; } 100% { top: 12%; } }

    /* ===== Member Photo ===== */
    .photo {
      width: 140px; height: 140px; border-radius: 16px; overflow: hidden; background:#0f1624;
      display: none; margin: 10px auto 0; border: 1px solid var(--border);
      box-shadow: 0 12px 24px rgba(0,0,0,.35);
    }
    .photo img { width: 100%; height: 100%; object-fit: cover; display:block; }

    .pill {
      display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; font-size:12px; margin-left:6px; border:1px solid transparent;
    }
    .pill.ok { background: color-mix(in oklab, var(--good) 18%, transparent); border-color: color-mix(in oklab, var(--good) 25%, #0f0f0f); color:#bff6da; }
    .pill.bad { background: color-mix(in oklab, var(--bad) 16%, transparent); border-color: color-mix(in oklab, var(--bad) 25%, #0f0f0f); color:#fecaca; }

    .note { background:#0b1220; border:1px dashed var(--border); border-radius: 12px; padding:12px; }

    /* ===== Footer actions sticky on mobile ===== */
    .actions { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
    @media (max-width: 560px) {
      .actions {
        position: sticky; bottom: 10px; padding: 8px; backdrop-filter: blur(8px);
        background: linear-gradient(180deg, rgba(10,14,22,.2), rgba(10,14,22,.55));
        border-radius: 999px; border: 1px solid var(--border);
      }
    }

    /* Accessibility */
    .visually-hidden { position: absolute !important; height: 1px; width: 1px; overflow: hidden; clip: rect(1px, 1px, 1px, 1px); white-space: nowrap; }
    :focus-visible { outline: 2px solid var(--brand); outline-offset: 3px; border-radius: 10px; }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">SkyGym</div>
      <nav>
        <a class="btn-outline" href="/create-user">Create User</a>
        <a class="btn-outline" href="/create-membership">Membership</a>
        <form action="/logout" method="POST" style="display:inline; margin:0;">
          <button class="btn-outline" type="submit">Log out</button>
        </form>
      </nav>
    </div>
  </header>

  <main class="container grid" aria-labelledby="page-title">
    <!-- Left: Scanner -->
    <section class="card stack" aria-label="QR scanner">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap;">
        <h1 id="page-title">Scan QR</h1>
        <span class="small subtle">Camera access required</span>
      </div>

      <div id="qrRegion">
        <!-- Decorative frame & animated line; camera stream is injected by html5-qrcode -->
        <div class="scan-frame" aria-hidden="true"></div>
        <div class="scan-line" aria-hidden="true"></div>
      </div>

      <div class="actions mt">
        <button id="stopBtn" class="btn-outline" type="button">Stop</button>
        <!-- Optional primary action you can wire up later e.g. torch toggle -->
        <!-- <button id="torchBtn" class="btn" type="button">Torch</button> -->
      </div>

      <div id="memberPhoto" class="photo" aria-live="polite" aria-atomic="true">
        <img alt="Member photo" id="memberPhotoImg" />
      </div>

      <div class="note mt">
        <div id="scanResult" class="small">Point the camera at a QR code…</div>
      </div>
    </section>

    <!-- Right: Status / Tips -->
    <aside class="card stack" aria-label="Status and tips">
      <h2>Session</h2>
      <div class="small subtle">Use the buttons to control the scanner. When a QR is recognized, details and photo will appear here.</div>

      <div class="mt">
        <div class="row small subtle">
          <span>Camera</span>
          <span id="camStatus" class="pill ok" role="status" aria-live="polite">Ready</span>
        </div>
      </div>

      <div class="mt">
        <h2>Tips</h2>
        <ul class="small subtle" style="margin:6px 0 0 18px; line-height:1.6;">
          <li>Hold the code ~15–25 cm from the lens.</li>
          <li>Good lighting = faster scans.</li>
        </ul>
      </div>
    </aside>
  </main>

  <script>
    // (Optional) Live status helpers that don't interfere with your existing /js/qr.js
    const camStatus = document.getElementById('camStatus');
    const setStatus = (ok, label) => {
      camStatus.textContent = label || (ok ? 'Ready' : 'Error');
      camStatus.classList.toggle('ok', !!ok);
      camStatus.classList.toggle('bad', !ok);
    };

    // Example hooks you can call from your existing qr.js:
    window.QRUI = {
      onStart:   () => setStatus(true, 'Scanning…'),
      onStop:    () => setStatus(true, 'Stopped'),
      onError:   (msg) => setStatus(false, msg || 'Camera error'),
      onSuccess: () => setStatus(true, 'Code detected')
    };
  </script>

  <script src="/js/qr.js"></script>
</body>
</html>
